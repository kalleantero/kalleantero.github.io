<!DOCTYPE html>
<html class="no-js" lang="en">

<!-- Mirrored from kalle-blog.azurewebsites.net/blog/azure-developer-cli by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 13:20:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>


    <!--- basic page needs
    ================================================== -->
    <meta charset="utf-8">
    <meta name="description" content="This blog is concentrated to Microsoft and cloud technology, coding and architecture. Solutions, tips and knowledge from a developer to developer.">

    <meta name="author" content="Kalle Marjokorpi">

    <!-- mobile specific metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="../css/vendor.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/cookieconsent.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="../css/tags.css">

    <!-- script
    ================================================== -->
    <script src="../js/modernizr.js"></script>
    <script defer src="../js/fontawesome/all.min.js"></script>

    <script type="text/plain" data-cookiecategory="analytics" async src="https://www.googletagmanager.com/gtag/js?id=G-DPTCQBZTWE"></script>
    <script type="text/plain" data-cookiecategory="analytics">
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-DPTCQBZTWE');
    </script>
    
    <script defer type="text/javascript">
        (function (c, l, a, r, i, t, y) {
            c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
            t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
            y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
        })(window, document, "clarity", "script", "gr1x6zhls1");
    </script>

    
    <title>How to boost developer workflow activities with AZD - Blog by Kalle Marjokorpi</title>
    <meta name="description" content="This blog post is an overview to Azure Developer CLI tool and how it helps to boost developer workflow activities.">
    <meta name="author" content="Kalle Marjokorpi">


    <script defer src="../js/cookieconsent.js"></script>
    <script defer src="../js/cookieconsent-config.js"></script>
    <script src="https://cdn.counter.dev/script.js" data-id="a019f4e1-6ec3-4293-8b98-7440925a9066" data-utcoffset="2"></script>

</head>
<body id="top">

    <!-- preloader
    ================================================== -->
    <div id="preloader">
        <div id="loader"></div>
    </div>

    <!-- header
    ================================================== -->

     <!-- header
    ================================================== -->
<header class="s-header s-header--opaque">

        <div class="s-header__logo">
            Kalle Marjokorpi
        </div>

        <div class="row s-header__navigation">

            

    <nav class="s-header__nav-wrap">
        <h3 class="s-header__nav-heading h6">Navigate to</h3>

        <ul class="s-header__nav">


            <li><a id="top-navigation-link-root" href="../index.html" title="Home">Home</a></li>

                <li><a id="top-navigation-link-about"  href="../about.html" title="About me">About me</a></li>
                <li><a id="top-navigation-link-talks"  href="../talks.html" title="Talks">Talks</a></li>


        </ul> <!-- end s-header__nav -->

        <a href="#0" title="Close Menu" class="s-header__overlay-close close-mobile-menu">Close</a>

    </nav> <!-- end s-header__nav-wrap -->


            

        </div> <!-- end s-header__navigation -->

        <a class="s-header__toggle-menu" href="#0" title="Menu"><span>Menu</span></a>

    </header> <!-- end s-header -->

    



    <!-- content
        ================================================== -->
    <section class="s-content">

        <div class="row">
            <div class="column large-12">

                <article class="s-content__entry format-standard">

                    <div class="s-content__entry-header">
                    <h1 class="s-content__title s-content__title--post">How to boost developer workflow activities with Azure Developer CLI?</h1>
                    </div> <!-- end s-content__entry-header -->

                    <div class="s-content__primary">

                        <div class="s-content__entry-content">

                            <p><!--StartFragment --></p>
<p>This blog post is an overview to Azure Developer CLI tool and how it helps to boost developer workflow activities. Microsoft has created a lot of great <a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/overview" rel="follow">documentation</a> about Azure Developer CLI. This blog post concentrates only main points and especially how to create a Web API project (App Service based + .NET 6) which is compatible with Azure Developer CLI.</p>
<h2>What is the Azure Developer CLI?</h2>
<p>Microsoft<span> announced the public preview of the&nbsp;</span>Azure Developer CLI<span> </span><span>in July 2022.&nbsp;</span>Azure Developer CLI (azd) is an open-source tool that accelerates the process of building cloud apps on Azure. The CLI provides best practice, developer-friendly commands that map to key stages in your workflow (ex. build, deployment, monitoring etc.), whether you&rsquo;re working in the terminal, your editor or integrated development environment (IDE), or DevOps.</p>
<p>You can use the azd with extensible azd templates that include everything you need to get an application up and running in Azure. These templates include application code, and reusable infrastructure as code assets. Community developed templates can be found from <a href="https://azure.github.io/awesome-azd/" rel="follow">here (Awesome azd templates)</a> and <a href="https://github.com/topics/azd-templates" rel="follow">here (GitHub)</a>.</p>
<p>Currently on October 2022 Azure Developer CLI supports the following Azure compute services: <strong>Azure App Service</strong>, <strong>Function</strong>, <strong>Azure Container Apps</strong>,&nbsp;<strong>Azure Static Web Apps</strong> and the following programming languages: <strong>Node.js</strong>, <strong>Python</strong>, <strong>.NET</strong>.</p>
<p>Sources:</p>
<p><a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/overview#supported-azure-compute-services-host" rel="follow">Supported compute services and programming languages | Microsoft Learn</a><br /><a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/overview">What is the Azure Developer CLI (preview)? | Microsoft Learn</a><br /><a href="https://devblogs.microsoft.com/azure-sdk/introducing-the-azure-developer-cli-a-faster-way-to-build-apps-for-the-cloud/">Introducing the Azure Developer CLI (azd): A faster way to build apps for the cloud - Azure SDK Blog (microsoft.com)</a></p>
<h2>Understand the architecture</h2>
<p>Below <a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/make-azd-compatible?pivots=azd-create" rel="follow">diagram</a> created by MS describes nicely the architecture of AZD. This blog post follows these main architecture points presented in this diagram.</p>
<p><a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/media/make-azd-compatible/workflow.png" rel="follow"><img src="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/media/make-azd-compatible/workflow.png" alt="Diagram of Azure Developer CLI template workflow." style="font-weight: 600; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;" /></a></p>
<h2><span>Let's get started</span></h2>
<h3><span>Prerequisites</span></h3>
<p><span>Before starting you need to install the following command line tools.</span></p>
<p><!--EndFragment --></p>
<p><strong>1. Install latest version of <a href="https://learn.microsoft.com/en-us/cli/azure/update-azure-cli" rel="follow">Azure CLI</a></strong></p>
<pre class="language-undefined"><code>az upgrade</code></pre>
<p><strong>2. Install <a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/install-azd?tabs=baremetal%2Cwindows" rel="follow">Azure Developer CLI</a></strong></p>
<pre class="language-undefined"><code>powershell -ex AllSigned -c "Invoke-RestMethod 'https://aka.ms/install-azd.ps1' | Invoke-Expression"
</code></pre>
<p><strong>3. Install Bicep CLI</strong></p>
<pre class="language-undefined"><code>az bicep upgrade</code></pre>
<h3>Create a project template</h3>
<p>These steps create a sample Web Api Visual Studio project which is used to deploy to Azure later.</p>
<p><strong>1. Create a solution</strong></p>
<p>Execute this command in root folder.</p>
<pre class="language-undefined"><code>dotnet new sln --name "Api.Template"</code></pre>
<p><strong>2. Create a new Dotnet Web API project</strong></p>
<p>Execute this command in root folder.</p>
<pre class="language-undefined"><code>dotnet new webapi -o src/Api.Template</code></pre>
<p><strong>3. Add Git ignore file</strong></p>
<pre class="language-undefined"><code>dotnet new gitignore</code></pre>
<p><strong>4. Add project to the solution</strong></p>
<pre class="language-undefined"><code>dotnet sln add src/Api.Template/Api.Template.csproj</code></pre>
<p>Now you should have this kind of folder structure:</p>
<pre class="language-undefined"><code>├── Api.Template.sln     [ Solution file ]
├── .gitignore           [ Git ignore file ]
├── src                  [ Source code folder ]
│   ├── Api.Template     [ Folder for Visual Studio WebAPI project ]</code></pre>
<h3>Initialize a project</h3>
<p>When Visual Studio project is created then project is ready to be initialized with Azure Developer CLI (AZD). Azure Developer CLI creates some configuration files during the initializing.</p>
<p><strong>1. Login to Azure subscription</strong></p>
<p>I recommend login to Azure subscription before starting environment initializing because otherwise you might need to submit subscription details manually.&nbsp;</p>
<pre class="language-undefined"><code>az login</code></pre>
<p><strong>2. Initialize a new environment with Azure Developer CLI</strong></p>
<p>Azure Developer CLI uses an environment name to set the AZURE_ENV_NAME environment variable that's used by Azure Developer CLI templates. Environment name is stored to environment configuration file. After environment initializing configurations can be found from <strong>.azure </strong>folder. It's also important to understand that environment name is also used as a prefix in the Azure Resource Group name. You can find more information about azd environments from <a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/faq#what-is-an-environment-name" rel="follow">here</a>.</p>
<p>This command prompts which template to use. Select "Empty template". I didn't find how to set empty template as a parameter. Execute this command in the root folder where solution file is located.</p>
<pre class="language-undefined"><code>azd init --location westeurope --subscription 00000000-0000-0000-0000-000000000000 --environment dev</code></pre>
<p>After initializing you have this kind of folder structure:</p>
<pre class="language-undefined"><code>├── Api.Template.sln      [ Solution file ]
├── .gitignore            [ Git ignore file ]
├── azure.yaml            [ Describes the app and type of Azure resources]
├── src                   [ Source code folder ]
│   ├── Api.Template      [ Folder for Visual Studio WebAPI project ]
├── .azure                [ Creates and configures Azure resources ]
│   ├── dev               [ Environment folder ]
│   │    ├── .env         [ Environment configuration file]
│   └── config.json       [ AZD Azure configuration file  ]
</code></pre>
<h3>Create the infrastructure files</h3>
<p>Azure infrastructure must be described with Bicep and files must be created to a directory called <strong>infra</strong>.</p>
<p><strong>1. Create folder for infra</strong></p>
<p>Infra folder should be created to the root folder.</p>
<p><strong>2. Create infrastructure (Bicep) files</strong></p>
<p>I prefer this kind of folder structure for infrastructure files:</p>
<pre class="language-undefined"><code>├── main.bicep                            [ Main bicep file ]
├── main.parameters.json                  [ Parameter file]
├── assets                                [ Assets folder ]
│   ├── abbreviations.json                [ JSON file which contains Azure resource abbreviations ]
├── modules                               [ Bicep modules folder ]
│   ├── applicationinsights.bicep         [ Application Insights bicep module ]
│   ├── appService.bicep                  [ App Service bicep module ]
│   ├── appServicePlan.bicep              [ App Service Plan bicep module ]
│   ├── logAnalyticsWorkspace.bicep       [ Log Analytics Workspace bicep module ]
│   └── resources.bicep                   [ Resource bicep file which orchestrates resource creation  ]
</code></pre>
<p>Note! You can create parameter file also with a Bicep CLI:</p>
<pre class="language-undefined"><code>az bicep generate-params --file main.bicep</code></pre>
<p>Add these parameter values to parameter file.</p>
<pre class="language-undefined"><code>{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "name": {
        "value": "${AZURE_ENV_NAME}"
        },
        "location": {
        "value": "${AZURE_LOCATION}"
        },
        "principalId": {
        "value": "${AZURE_PRINCIPAL_ID}"
        }
    }
}</code></pre>
<h3><span>Update Azure.yaml file</span></h3>
<p><span>Azure Developer CLI (AZD) needs to know details of your application to enable deployment of infrastructure and application to Azure. Basically, azure.yaml describes the app and type of Azure resources. Main configuration points are under services root element. </span></p>
<pre class="language-undefined"><code>name: Api.Template
metadata:
  template: webapi-template-azd@0.0.1-beta
services:
  appService:
    project: src/Api.Template
    language: csharp
    host: appservice
    resourceName: app-microservice-westeurope-001</code></pre>
<table border="0">
<tbody>
<tr>
<td>
<p><strong>Element</strong></p>
</td>
<td>
<p><strong>Description</strong></p>
</td>
</tr>
<tr>
<td>
<p><span>AppService </span></p>
</td>
<td>
<p><span>Name of the service</span></p>
</td>
</tr>
<tr>
<td>
<p><span>Project </span></p>
</td>
<td>
<p><span>Path to the source folder</span></p>
</td>
</tr>
<tr>
<td>
<p><span>Host </span></p>
</td>
<td>
<p><span>Type of Azure resource used for service implementation</span></p>
</td>
</tr>
<tr>
<td>
<p><span>Language </span></p>
</td>
<td>
<p><span>Service implementation language</span></p>
</td>
</tr>
<tr>
<td>
<p><span>ResourceName</span></p>
</td>
<td>
<p><span>Name of the Azure resource that implements the service. If ResourceName is not used, then resource tag called "azd-service-name" is used to find a resource where application will be deployed.</span><span></span></p>
</td>
</tr>
</tbody>
</table>
<p><span>More information about updating azure.yaml can be found from <a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/make-azd-compatible?source=recommendations&amp;pivots=azd-create#update-azureyaml" rel="follow">here</a>. Schema of azure.yaml is available in <a href="https://github.com/Azure/azure-dev/blob/main/schemas/v1.0/azure.yaml.json/" rel="follow">here</a>.</span></p>
<h3><span>Provision &amp; Deploy</span></h3>
<p><span>Azure Developer CLI provides different commands whether if you just want to deploy only application or infrastructure or both.</span><span></span></p>
<p><span></span><strong>Deploy infrastructure and application to Azure</strong></p>
<pre class="language-undefined"><code>azd up</code></pre>
<p><strong>Deploy only application to Azure</strong></p>
<pre class="language-undefined"><code>azd deploy</code></pre>
<p><strong>Deploy only infrastructure to Azure</strong></p>
<pre class="language-undefined"><code>azd provision</code></pre>
<p><strong>Lastly if you want to remove created resource from Azure you can use the following command:</strong></p>
<pre class="language-undefined"><code>azd down</code></pre>
<h2><span>Templating</span></h2>
<p>Azure Developer CLI enables to use project templates published to GitHub. You can use community driven templates or use own template.</p>
<p><strong>Initialize project using custom template</strong></p>
<p>Template is available from GitHub.</p>
<div>
<pre class="language-undefined"><code>azd init --template kalleantero/Api.Template</code></pre>
</div>
<p><strong>Deploy infrastructure and application to Azure</strong></p>
<pre class="language-undefined"><code>azd up</code></pre>
<p><span>Super easy, just two commands and working environment is up and running in Azure.</span></p>
<h2><span>Summary</span></h2>
<p><span>Azure Developer CLI widely supports different software development workflow activities like build, deployment and also monitoring &amp; setting up CI/CD which weren't handled in this blog post.&nbsp;</span><span></span><span>Command interface of Azure Developer CLI is very intuitive, and commands wraps different Azure and Bicep CLI commands together behind the scenes. Of course, you can do almost all same things just using different Azure CLI and Bicep CLI commands separately but using Azure Developer CLI makes things more straightforward.&nbsp;</span></p>
<p><span>I see that this tool is very useful especially if you need to quickly set up new developer environment and maybe test something. Using own templates is also very interesting option. Azure Developer CLI is currently still in preview and there are some limitations,&nbsp;but I believe that interesting features are coming in the future to this tool.</span><span></span><span></span></p>
<p><span>Source code of this sample project is available in <a href="https://github.com/kalleantero/Api.Template" rel="follow">GitHub</a>.</span></p>
<p><!--EndFragment --></p>

                        </div> <!-- end s-entry__entry-content -->

                        <div class="s-content__entry-meta">

                            <div class="entry-author meta-blk">
                                <div class="author-avatar">
                                <img class="avatar" src="../images/avatars/kalle.jpg" alt="">
                                </div>
                                <div class="byline">
                                    <span class="bytext">Posted By</span>
                                    Kalle Marjokorpi
                                </div>
                            </div>

                            <div class="meta-bottom">

                                <div class="entry-cat-links meta-blk">

                                    <span>On</span>
26.10.2022                                </div>

                                <div class="entry-tags meta-blk">
                                    <span class="tagtext">Tags</span>
                                            <a id="post-category-azure" href="category/azure.html">Azure</a>
                                            <a id="post-category-bicep" href="category/bicep.html">bicep</a>
                                            <a id="post-category-developer-tools" href="category/developer-tools.html">developer tools</a>
                                </div>

                            </div>

                        </div> <!-- s-content__entry-meta -->

                        <div class="s-content__pagenav">
                            <div class="prev-nav">
                                    <a id="post-previous-tech-stack-of-the-blog" href="tech-stack-of-the-blog.html" rel="prev">
                                        <span>Previous</span>
                                        How has the tech stack of this blog evolved?
                                    </a>
                            </div>
                            <div class="next-nav">

                 
                                <a id="post-next-control-your-digital-footprint" href="control-your-digital-footprint.html" rel="next">
                                    <span>Next</span>
                                    Privacy matters - Control your digital footprint
                                </a>

                            
                            </div>
                        </div> <!-- end s-content__pagenav -->

                    </div> <!-- end s-content__primary -->
                </article> <!-- end entry -->

            </div> <!-- end column -->
        </div> <!-- end row -->
        <!-- comments
        ================================================== -->
        <div class="comments-wrap">

            <div id="comments" class="row">
                <div class="column large-12">

                    <h3>Comments</h3>

                    <script src="https://utteranc.es/client.js"
                            repo="kalleantero/kalleantero.github.io"
                            issue-term="url"
                            theme="github-light"
                            crossorigin="anonymous"
                            async>
                    </script>                   

                </div> <!-- end col-full -->
            </div> <!-- end comments -->

        </div> <!-- end comments-wrap -->

    </section> <!-- end s-content -->

    

<!-- footer
================================================== -->
<footer class="s-footer">

    <div class="s-footer__bottom">
        <div class="row">
            <div class="column">
                <div class="ss-copyright">
                    <span>Copyright Kalle Marjokorpi 2024</span>
                    <span>Design by <a href="http://www.styleshout.com/">styleshout</a></span>
                    <span>Content management by <a href="http://www.buttercms.com/">Headless ButterCMS</a></span>

                </div> <!-- end ss-copyright -->
            </div>
        </div>

        <div class="ss-go-top">
            <a class="smoothscroll" title="Back to Top" href="#top">
                <svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M7.5 1.5l.354-.354L7.5.793l-.354.353.354.354zm-.354.354l4 4 .708-.708-4-4-.708.708zm0-.708l-4 4 .708.708 4-4-.708-.708zM7 1.5V14h1V1.5H7z" fill="currentColor"></path></svg>
            </a>
        </div> <!-- end ss-go-top -->
    </div> <!-- end s-footer__bottom -->

</footer> <!-- end s-footer -->
   
    <!-- Java Script
     ================================================== -->

    
    
    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "cac9fd24c1c04b6d9984ea31685b0414"}'></script><!-- End Cloudflare Web Analytics -->
    
    <script src="../js/jquery-3.5.0.min.js"></script>
    <script src="../js/plugins.js"></script>
    <script src="../js/main.js"></script>

    <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="kmarjok" data-description="Support me on Buy me a coffee!" data-message="" data-color="#40DCA5" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

</body>

<!-- Mirrored from kalle-blog.azurewebsites.net/blog/azure-developer-cli by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 13:20:39 GMT -->
</html>
