<!DOCTYPE html>
<html>

<!-- Mirrored from kalle-blog.azurewebsites.net/blog/omakannan-omatietovaranto by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 24 Apr 2021 06:43:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>

    <!-- Google Tag Manager -->
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    '../../www.googletagmanager.com/gtm5445.html?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-MPLFPSF');</script>
    <!-- End Google Tag Manager -->

    <!--- basic page needs
    ================================================== -->
    <meta charset="utf-8">

    
    <title>Omakannan Omatietovaranto - Blog by Kalle Marjokorpi</title>
    <meta name="description" content="I recently familiarized about Omatietovaranto (Finnish Personal Health Record) data repository service and web interfaces in a work project.">
    <meta name="author" content="Kalle Marjokorpi">


    <!-- mobile specific metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/vendor.css">
    <link rel="stylesheet" href="../css/main.css">

    <script src="../js/modernizr.js"></script>
    <script src="../js/pace.min.js"></script>

    <script type="text/javascript">!function(T,l,y){var S=T.location,u="script",k="instrumentationKey",D="ingestionendpoint",C="disableExceptionTracking",E="ai.device.",I="toLowerCase",b="crossOrigin",w="POST",e="appInsightsSDK",t=y.name||"appInsights";(y.name||T[e])&&(T[e]=t);var n=T[t]||function(d){var g=!1,f=!1,m={initialize:!0,queue:[],sv:"4",version:2,config:d};function v(e,t){var n={},a="Browser";return n[E+"id"]=a[I](),n[E+"type"]=a,n["ai.operation.name"]=S&&S.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(m.sv||m.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:e,name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}var h=d.url||y.src;if(h){function a(e){var t,n,a,i,r,o,s,c,p,l,u;g=!0,m.queue=[],f||(f=!0,t=h,s=function(){var e={},t=d.connectionString;if(t)for(var n=t.split(";"),a=0;a<n.length;a++){var i=n[a].split("=");2===i.length&&(e[i[0][I]()]=i[1])}if(!e[D]){var r=e.endpointsuffix,o=r?e.location:null;e[D]="https://"+(o?o+".":"")+"dc."+(r||"services.visualstudio.com")}return e}(),c=s[k]||d[k]||"",p=s[D],l=p?p+"/v2/track":config.endpointUrl,(u=[]).push((n="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",a=t,i=l,(o=(r=v(c,"Exception")).data).baseType="ExceptionData",o.baseData.exceptions=[{typeName:"SDKLoadFailed",message:n.replace(/\./g,"-"),hasFullStack:!1,stack:n+"\nSnippet failed to load ["+a+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(S&&S.pathname||"_unknown_")+"\nEndpoint: "+i,parsedStack:[]}],r)),u.push(function(e,t,n,a){var i=v(c,"Message"),r=i.data;r.baseType="MessageData";var o=r.baseData;return o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/\"/g,"")+'"',o.properties={endpoint:a},i}(0,0,t,l)),function(e,t){if(JSON){var n=T.fetch;if(n&&!y.useXhr)n(t,{method:w,body:JSON.stringify(e),mode:"cors"});else if(XMLHttpRequest){var a=new XMLHttpRequest;a.open(w,t),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(e))}}}(u,l))}function i(e,t){f||setTimeout(function(){!t&&m.core||a()},500)}var e=function(){var n=l.createElement(u);n.src=h;var e=y[b];return!e&&""!==e||"undefined"==n[b]||(n[b]=e),n.onload=i,n.onerror=a,n.onreadystatechange=function(e,t){"loaded"!==n.readyState&&"complete"!==n.readyState||i(0,t)},n}();y.ld<0?l.getElementsByTagName("head")[0].appendChild(e):setTimeout(function(){l.getElementsByTagName(u)[0].parentNode.appendChild(e)},y.ld||0)}try{m.cookie=l.cookie}catch(p){}function t(e){for(;e.length;)!function(t){m[t]=function(){var e=arguments;g||m.queue.push(function(){m[t].apply(m,e)})}}(e.pop())}var n="track",r="TrackPage",o="TrackEvent";t([n+"Event",n+"PageView",n+"Exception",n+"Trace",n+"DependencyData",n+"Metric",n+"PageViewPerformance","start"+r,"stop"+r,"start"+o,"stop"+o,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),m.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4};var s=(d.extensionConfig||{}).ApplicationInsightsAnalytics||{};if(!0!==d[C]&&!0!==s[C]){method="onerror",t(["_"+method]);var c=T[method];T[method]=function(e,t,n,a,i){var r=c&&c(e,t,n,a,i);return!0!==r&&m["_"+method]({message:e,url:t,lineNumber:n,columnNumber:a,error:i}),r},d.autoExceptionInstrumented=!0}return m}(y.cfg);(T[t]=n).queue&&0===n.queue.length&&n.trackPageView({})}(window,document,{
src: "../../az416426.vo.msecnd.net/scripts/b/ai.2.min.js",
cfg: { 
    connectionString: 'InstrumentationKey=ebdfbae8-ec79-4f33-b5c3-ad05861ae331;IngestionEndpoint=https://westeurope-5.in.applicationinsights.azure.com/'
}});
    </script>
</head>
<body id="top">

    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MPLFPSF"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
    <!-- header
    ================================================== -->

    
        <!-- header
   ================================================== -->

<header class="s-header">

    <div class="header-logo">
        <a class="site-logo" href="../index.html"><img src="../images/logo2.png" alt="Homepage"></a>
    </div>

    

    <nav class="header-nav-wrap">

        <ul class="header-nav">


            <li class="current"><a id="top-navigation-link-root" href="../index.html" title="">Home</a></li>

                <li id="top-navigation-link-about" class="smoothscroll"><a href="../about.html" title="">About me</a></li>

        </ul>
    </nav> <!-- end main-nav-wrap -->




    <a class="header-menu-toggle" href="#0"><span>Menu</span></a>

</header> <!-- end s-header -->


    

    

<!-- content
   ================================================== -->


    <article class="blog-single">

        <!-- page header/blog hero
    ================================================== -->

        
        <div class="page-header page-header--single page-hero" style=background-image:url(https://cdn.buttercms.com/1S5lR5rsQjCphCOrQ67Q)>

            <div class="row page-header__content narrow">
                <article class="col-full">
                    <div class="page-header__info">
                        <div class="page-header__cat">
                                <a id="post-category-omatietovaranto" href="category/omatietovaranto.html">Omatietovaranto</a>
                                <a id="post-category-phr" href="category/phr.html">PHR</a>
                        </div>
                    </div>
                    <h1 class="page-header__title">
                        <a href="#0" title="">
                            Experiences about Finnish Personal Health Record data repository (part 1)
                        </a>
                    </h1>
                    <ul class="page-header__meta">
                        <li class="date">
26.09.2018 15:00                        </li>
                        <li class="author">
                            By
                            <span>Kalle Marjokorpi</span>
                        </li>
                    </ul>

                </article>
                
            </div>

        </div> <!-- end page-header -->

        <div class="row blog-content">
            <div class="col-full blog-content__main">

                <p><p>I recently familiarized about Omatietovaranto (Finnish Personal Health Record) data repository service and web interfaces in a work project. Omatietovaranto (PHR) is centralized national location for health and well being data which is produced or measured in applications or devices. Measurable data (observations) can be like steps, activity, weight, blood pressure etc. Omatietovaranto (PHR) is owned by National institute for health and welfare. System is developed and maintained by Kela.</p>
<p>PHR data repository accepts data models in HL7 FIHR standard data format which is a common standard in health systems all around the world. Data content is developed nationally with HL 7 Finland. You can find more information about HL7 Finland from <a href="https://www.hl7.fi/">https://www.hl7.fi</a> and generally from <a href="https://www.hl7.org/">https://www.hl7.org</a>.</p>
<p>Suppliers can integrate their well being and health applications to the PHR if various acceptance criteria are accepted and test process is successfully passed. Tests are controlled and managed by Kela. Acceptance criteria are mostly related general security practices, social and health regulation and data protection of the application. Acceptance criteria must be accepted before applying to the QA-environment (aka AT-test). If healthcare professionals are able to use citizen's PHR data then application should be validated and certified as Class A application (Social and healthcare data system). You can get more information about healthcare professional application requirements from Kela.</p>
<p>Suppliers can freely familiarize to PHR data repository via Sandbox environment which is offered by Kela. Sandbox environment is not fully identically with the real production environment but It's a good place to start. Official site of PHR and information about Sandbox environment can be find from here <a href="https://www.kanta.fi/en/system-developers/sandbox-environments">https://www.kanta.fi/en/system-developers/sandbox-environments</a></p>
<h2>Knowledge prerequisites before starting</h2>
<p>I listed a few technologies with you should familiarize before start developing and integrating your application to the PHR data repository.</p>
<p><b>Oauth 2.0</b></p>
<p>Authorization is handled with Oauth 2.0 protocol in PHR data repository. You should be familiar with Oauth 2.0 authorization flow and most important terms of the flow: authorization server, authorization code, access token, refresh token and resource server.</p>
<p><a href="https://oauth.net/2/">Oauth 2.0</a><br /><a href="https://aaronparecki.com/oauth-2-simplified/">Oauth 2.0 simplified</a><br /><a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2">Introduction to Oauth 2.0</a>&nbsp;(has a good picture about Oauth 2.0 authorization flow)<br />Authorization service in Sandbox environment is located at <a href="https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/">https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/</a>.</p>
<p><b>Client certificates</b></p>
<p>PHR QA and production environments require a client certificate which should be passed in requests which are heading to the Token or Resource Server endpoints. Note: Sandbox environment does not require client certificate. Certificate (well being application certificate) should be applied from the Population Register Centre (VRK) when application is approved to the acceptance test.</p>
<p><a href="https://www.websecurity.symantec.com/security-topics/client-certificates-vs-server-certificates">Client certificate vs Server certificate</a><br /><a href="https://dydprogrammer.wordpress.com/2016/12/08/c-httpclient-with-client-certificates/">C#: HttpClient with client certificates</a></p>
<p><b>REST API</b></p>
<p>You should understand how to consume REST API because Omatietovaranto PHR resource server is a REST API.</p>
<p><a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST API</a><br /><a href="http://fhirsandbox.kanta.fi/phr-resourceserver-ui/">HAPI-FHIR Sandbox Enviroment Resource Server tool</a><br /><a href="https://www.hl7.org/fhir/http.html">Resource server documentation</a><br />Resource server is located at <a href="https://fhirsandbox2.kanta.fi/phr-resourceserver/baseStu3">https://fhirsandbox2.kanta.fi/phr-resourceserver/baseStu3</a>.</p>
<p><b>FIHR data models</b></p>
<p>Simplifier Finnish PHR site contains a lot of information about national data models. You can find data model examples from the site. Finnish PHR implementation guide contains ex. min and max data contents of the models.</p>
<p><a href="https://simplifier.net/guide/FinnishPHRImplementationGuideAT">Finnish PHR implementation guide</a><br /><a href="https://simplifier.net/FinnishPHR">Finnish PHR</a><br /><a href="https://en.wikipedia.org/wiki/Fast_Healthcare_Interoperability_Resources">Fast Healthcare Interoperability Resources</a><br /><a href="https://www.hl7.org/fhir/">Official site of FHIR</a></p>
<h2>A few notes about Sandbox environment</h2>
<ol>
<li>Sandbox Environment does not require a Client certificate</li>
<li>Sandbox Environment is not updated so frequently than other environments</li>
<li>Sandbox Environment has known issues with self service portal (ex. PHR application client information is not possible to edit after creation - 27.10.2018 fixed)</li>
<li>If you use HAPI-FIHR Resource server tool and you want to observe queries with browser developer tool or Fiddler, notice that tool might use obsolete query standards. You should check all Resource server query parameters from <a href="https://www.hl7.org/fhir/http.html">https://www.hl7.org/fhir/http.html</a></li>
<li>There are differences in server URL:s when using Authorization, Token and Resource endpoints in Sandbox and other environments</li>
</ol></p>

            <h2>Comments</h2>

                <p><div id="disqus_thread"></div></p>

                <div class="blog-content__pagenav">
                    <div class="blog-content__nav">
                            <div class="blog-content__prev">
                                <a id="post-previous-participant-registration-system" href="participant-registration-system.html" rel="prev">
                                    <span>Previous Post</span>
                                    Participant registration system for runners event
                                </a>
                            </div>
                            <div class="blog-content__next">
                                <a id="post-next-experiences-about-finnish-personal-health-record-national-data-repository-part-2" href="experiences-about-finnish-personal-health-record-national-data-repository-part-2.html" rel="next">
                                    <span>Next Post</span>
                                    Experiences about Finnish Personal Health Record data repository (part 2)
                                </a>
                            </div>
                        </div>


                    <div class="blog-content__all">
                        <a href="../index.html" class="btn btn--primary">
                            View All Post
                        </a>
                    </div>
                </div>

            </div><!-- end blog-content__main -->
        </div> <!-- end blog-content -->

    </article>



    
        

<!-- footer
    ================================================== -->
<footer>
    <div class="row">
        <div class="col-full">

            <div class="footer-logo">
                <a class="footer-site-logo" href="#0"><img src="../images/name.png" alt="Homepage"></a>
            </div>

            <ul class="footer-social">
                <li>
                    <a href="https://www.twitter.com/kmarjok">
                        <i class="im im-twitter" aria-hidden="true"></i>
                        <span>Twitter</span>
                    </a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/kallemarjokorpi">
                        <i class="im im-linkedin" aria-hidden="true"></i>
                        <span>Linkedin</span>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/kalleantero">
                        <i class="im im-github" aria-hidden="true"></i>
                        <span>Github</span>
                    </a>
                </li>
            </ul>

        </div>
    </div>

    <div class="row footer-bottom">

        <div class="col-twelve">
            <div class="copyright">
                <span>Copyright Kalle Marjokorpi 2021</span>
                <span>Design by <a href="http://www.styleshout.com/">styleshout</a></span>
                <span>Content management by <a href="http://www.buttercms.com/">Headless ButterCMS</a></span>

            </div>

        </div>

    </div> <!-- end footer-bottom -->

</footer> <!-- end footer -->
    


    <div id="preloader">
        <div id="loader"></div>
    </div>

    <!-- Java Script
     ================================================== -->
    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/plugins.js"></script>
    <script src="../js/main.min.js"></script>
    

    <script>
        (function () { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = '../../blog-by-kalle-marjokorpi.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <script id="dsq-count-scr" src="../../blog-by-kalle-marjokorpi.disqus.com/count.js" async></script>

    <!-- Cloudflare Web Analytics -->
    <script defer src='../../static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "cac9fd24c1c04b6d9984ea31685b0414"}'></script><!-- End Cloudflare Web Analytics -->

</body>

<!-- Mirrored from kalle-blog.azurewebsites.net/blog/omakannan-omatietovaranto by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 24 Apr 2021 06:43:36 GMT -->
</html>
